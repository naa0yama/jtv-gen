# JTV Gen - Japanese TV Content Generator

æ—¥æœ¬ã®ãƒ†ãƒ¬ãƒ“æ”¾é€ã«æ“¬ä¼¼ã—ãŸãƒ€ãƒŸãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

## æ¦‚è¦

JTV Gen ã¯ã€æ—¥æœ¬ã®ãƒ†ãƒ¬ãƒ“æ”¾é€è¦æ ¼ã«æº–æ‹ ã—ãŸ MPEG-TS å½¢å¼ã®ãƒ€ãƒŸãƒ¼æ”¾é€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€CMã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€å®Œå…¨ãªæ”¾é€ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ä½œæˆã§ãã¾ã™ã€‚

## ä¸»ãªæ©Ÿèƒ½

- ğŸ¥ **æœ¬ç·¨ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç”Ÿæˆ** - ãƒ­ã‚´ä»˜ããƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã§ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆ
- ğŸ“º **CM ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç”Ÿæˆ** - 15ç§’é–“éš”ã®æ—¥æœ¬ã®æ”¾é€åŸºæº–ã«æº–æ‹ ã—ãŸ CM ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ
- ğŸ”‡ **ç„¡éŸ³åŒºé–“** - CM ã®å‰å¾Œã«è‰²åè»¢ã‚’ä¼´ã†ç„¡éŸ³åŒºé–“ã‚’è‡ªå‹•æŒ¿å…¥
- ğŸ“¡ **PSI/SI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿** - EITã€SDTã€TOT ã‚’å«ã‚€å®Œå…¨ãªæ”¾é€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
- âš™ï¸ **è¨­å®šå¯èƒ½ãªæ§‹æˆ** - CSV å½¢å¼ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ç•ªçµ„æ§‹æˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- ğŸšï¸ **éŸ³å£°ãƒ¬ãƒ™ãƒ«æº–æ‹ ** - æ—¥æœ¬ã®æ”¾é€åŸºæº–ã«æº–æ‹ ã—ãŸéŸ³å£°ãƒ¬ãƒ™ãƒ«ï¼ˆ-20dBFS for 0VUï¼‰

## æŠ€è¡“ä»•æ§˜

- **æ˜ åƒ**: MPEG-2, 1440x1080, 16:9, 29.97fps **Progressive**
- **éŸ³å£°**: AAC-LC (MPEG-4), 48kHz, ã‚¹ãƒ†ãƒ¬ã‚ª, 248kbps
- **ã‚³ãƒ³ãƒ†ãƒŠ**: MPEG-TSï¼ˆé©åˆ‡ãªã‚¹ãƒˆãƒªãƒ¼ãƒ  ID ä»˜ãï¼‰
- **è¦æ ¼**: ARIB æº–æ‹ ï¼ˆæ—¥æœ¬ã®åœ°ä¸Šãƒ‡ã‚¸ã‚¿ãƒ«æ”¾é€ï¼‰

> [!IMPORTANT]
> æ—¥æœ¬ã®ãƒ†ãƒ¬ãƒ“æ”¾é€ã®æ˜ åƒã¯ MPEG-2 1440x1080 [SAR 4:3 DAR 16:9] 29.97fps interlaced ã®æ˜ åƒã§ã™ãŒã€ãƒ­ã‚´è§£æãŒæ©Ÿèƒ½ã™ã‚‹å“è³ªã«ã™ã‚‹ã«ã¯ã‹ãªã‚Šé«˜ã„ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆã¨ç”Ÿæˆæ™‚é–“ã‚’å¿…è¦ã¨ã—ãŸãŸã‚è¦‹é€ã£ã¦ã„ã¾ã™ã€‚  
> ã¾ãŸéŸ³å£°ã«ã¤ã„ã¦ã‚‚å³å¯†ã«ã¯ MPEG-2 AAC LC ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ãŒ fdk-aac ãªã©ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å•é¡Œã§åˆ©ç”¨ãŒé™ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ MPEG-4 AAC LC ã§ä»£ç”¨ã—ã¦ã„ã¾ã™ã€‚

## ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

- **FFmpeg** - MPEG-2 ãŠã‚ˆã³ AAC ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¯¾å¿œ
- **TSDuck** - PSI/SI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ³¨å…¥ç”¨ï¼ˆ3.41 ä»¥é™ï¼‰
- **bc** - æŒç¶šæ™‚é–“è¨ˆç®—ç”¨
- **Unix ãƒ„ãƒ¼ãƒ«** - grep, awk, md5sum, jq ãªã©

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### TSDuck ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Ubuntu 24.04 LTS ã®å ´åˆï¼š

```bash
# æœ€æ–°ãƒªãƒªãƒ¼ã‚¹ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
wget "https://github.com/tsduck/tsduck/releases/latest/download/tsduck_*.deb"
sudo apt --fix-broken install "./tsduck_*.deb"

```

ãã®ä»–ã®ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ï¼š

https://tsduck.io/download/tsduck/

### ãã®ä»–ã®ä¾å­˜é–¢ä¿‚

Ubuntu/Debianï¼š

```bash
sudo apt update
sudo apt install ffmpeg bc jq fonts-ubuntu

```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```bash
## é©å½“ãª Linux ç’°å¢ƒã§
curl -o jtv_gen.sh -sfSL https://raw.githubusercontent.com/naa0yama/jtv-gen/refs/heads/main/jtv_gen.sh
chmod +x jtv_gen.sh

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ç”Ÿæˆ
./jtv_gen.sh

# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
./jtv_gen.sh --debug

# ã‚«ã‚¹ã‚¿ãƒ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨
./jtv_gen.sh -c custom_scene.conf

# ç¢ºèªã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦è‡ªå‹•å®Ÿè¡Œ
./jtv_gen.sh --debug -c scene_06min.conf -y

```

[rigaya/Amatsukaze](https://github.com/rigaya/Amatsukaze) ã§æ˜ åƒãƒ‡ãƒ¼ã‚¿ãŒèªè­˜ã§ãã‚‹ã“ã¨ã‚’ç›®æ¨™ã«è£½ä½œã—ãŸãŸã‚ã€ `./jtv_gen.sh --debug -c scene_30min.conf -y` ãªã©ã§è‹¥å¹²é•·å°ºã®æ˜ åƒã‚’å‡ºã—ã€ãƒ­ã‚´ç™»éŒ²ã‚’ã™ã‚‹ã“ã¨ã§ CM ã‚«ãƒƒãƒˆã®ãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

![image](img/b4bb641822ea.png)

<details>
<summary>å®Ÿè¡Œã—ãŸãƒ­ã‚°ã®ã‚µãƒ³ãƒ—ãƒ«</summary>

```bash
./jtv_gen.sh -y
=== JTV Gen Started ===
Timestamp: Tue Aug  5 12:02:38 AM JST 2025
Checking system dependencies and capabilities
Verifying FFmpeg codec and filter support
Warnings - Some features may be limited:
  - MPEG-2 video codec may not be available
  - AAC audio codec may not be available
  - drawtext filter for text overlay may not be available
  - Ubuntu font (install with: sudo apt install fonts-ubuntu) may not be available
Script will attempt to run with available codecs/filters
âœ“ All dependencies available
âœ“ FFmpeg version: 6.1.1-3ubuntu5
âœ“ All required codecs and filters available
Loading configuration from scene_06min.conf
Loaded 10 segments and 19 configuration parameters
Preparing temporary directories
Generating comprehensive PSI/SI tables
Generated comprehensive PSI/SI tables:
  PAT:         temp/pat.xml (Program Association Table)
  NIT:         temp/nit.xml (Network Information Table)
  SDT:         temp/sdt.xml (Service Description Table)
  EIT:         temp/eit.xml (Event Information Table)
  TOT:         temp/tot.xml (Time Offset Table)
  PMT:         temp/pmt.xml (Program Map Table)
=== Media Configuration Preview ===
Configuration: scene_06min.conf
Output:        output/scene_06min/jtv_scene_06min.ts

Video:         MPEG-2, progressive, 1440x1080 [SAR 4:3, DAR 16:9]
               30000/1001 fps, bitrate min 1M, avg 6M, maxrate 12M
Audio:         aac, 48000Hz, 2ch, 248k
Duration:      00:06:00 (10793 frames)
Broadcast:     Service ID 65024, Transport Stream ID 10153
               Service: "JTV Gen" by "FFmpeg"
               Network: "Generated by naa0yama"
EIT Metadata:  Start time 2024-12-31 15:00:00 UTC, Present/Following enabled

=== Segment Structure Preview ===
SECTION_TYPE    SECTION_NAME         START_FRAME  END_FRAME    FRAME_COUNT  TIMESTAMP                
============    ============         ===========  =========    ===========  =======================  
Main            Main_1               0            1198         1199         00:00:00.00 - 00:00:39.29 ( 39.973s)
CM              CM1-1                1199         2097         899          00:00:40.00 - 00:01:09.29 ( 29.963s)
Main            Main_2               2098         7191         5094         00:01:10.00 - 00:03:59.28 (169.936s)
CM              CM2-1                7192         7641         450          00:03:59.29 - 00:04:14.29 ( 14.982s)
CM              CM2-2                7642         8540         899          00:04:14.30 - 00:04:44.29 ( 29.963s)
CM              CM2-3                8541         8990         450          00:04:44.30 - 00:04:59.29 ( 14.982s)
CM              CM2-4                8991         9439         449          00:04:59.30 - 00:05:14.28 ( 14.948s)
CM              CM2-5                9440         9888         449          00:05:14.29 - 00:05:29.28 ( 14.948s)
CM              CM2-6                9889         10338        450          00:05:29.29 - 00:05:44.28 ( 14.982s)
CM              CM2-7                10339        10793        455          00:05:44.29 - 00:06:00.04 ( 15.148s)

Auto-confirmed with -y option. Starting generation...
Generating individual segments
Using 4 parallel jobs (CPU cores: 60)
Processing 10 segments asynchronously
Overall: 001/010 (010.00%)
Completed: CM2-2
Overall: 002/010 (020.00%)
Completed: CM1-1
Overall: 003/010 (030.00%)
Completed: Main_1
Overall: 004/010 (040.00%)
Completed: CM2-6
Overall: 005/010 (050.00%)
Completed: CM2-7
Overall: 006/010 (060.00%)
Completed: CM2-1
Waiting for remaining jobs to complete...
Overall: 007/010 (070.00%)
Completed: CM2-3
Overall: 008/010 (080.00%)
Completed: CM2-5
Overall: 009/010 (090.00%)
Completed: CM2-4
Overall: 010/010 (100.00%)
Completed: Main_2
All 10 segments generated successfully
Concatenating segments to intermediate output
Found 10 segment files to concatenate
Intermediate output created: temp/scene_06min/jtv_scene_06min.ts
Injecting comprehensive PSI/SI metadata
Compiling PSI/SI tables
Compiling pat.xml
âœ“ pat.bin compiled successfully
Compiling pmt.xml
âœ“ pmt.bin compiled successfully
Compiling nit.xml
âœ“ nit.bin compiled successfully
Compiling sdt.xml
âœ“ sdt.bin compiled successfully
Compiling eit.xml
âœ“ eit.bin compiled successfully
Compiling tot.xml
âœ“ tot.bin compiled successfully
Injecting PSI/SI tables
âœ“ pat.bin ready for injection
âœ“ pmt.bin ready for injection
âœ“ nit.bin ready for injection
âœ“ sdt.bin ready for injection
âœ“ eit.bin ready for injection
âœ“ tot.bin ready for injection
Starting injection with 6 tables
Using comprehensive PSI/SI injection
Executing: tsp --japan --add-input-stuffing 1/25 -I file "temp/scene_06min/jtv_scene_06min.ts" -P inject "temp/scene_06min/pat.bin" --pid 0 --replace -P inject "temp/scene_06min/nit.bin" --pid 16 --inter-packet 250 -P inject "temp/scene_06min/sdt.bin" --pid 17 --replace -P inject "temp/scene_06min/eit.bin" --pid 18 --inter-packet 250 -P inject "temp/scene_06min/tot.bin" --pid 20 --inter-packet 2500 -P inject "temp/scene_06min/pmt.bin" --pid 257 --replace -P continuity --fix -O file "temp/scene_06min/jtv_scene_06min_with_metadata.ts"
'temp/scene_06min/jtv_scene_06min_with_metadata.ts' -> 'temp/scene_06min/jtv_scene_06min.ts'
Optimized PSI/SI metadata injection completed successfully
Analyzing injected tables:
|  First TOT local time stamp: ......................... 2025/01/01 09:00:00  |
|  Last TOT local time stamp: .......................... 2025/01/01 09:00:00  |
|  TOT country code: ................................................... JPN  |
|  0x0011  SDT/BAT ...................................... C        3,177 b/s  |
|  0x0012  EIT .......................................... C       10,338 b/s  |
|  0x0014  TDT/TOT ...................................... C        1,036 b/s  |
|  PID: 0x0011 (17)                                                  SDT/BAT  |
|  PID: 0x0012 (18)                                                      EIT  |
|  PID: 0x0014 (20)                                                  TDT/TOT  |
|  PID: 0x0011 (17)                                                  SDT/BAT  |
|  0x42 (66, SDT Actual), TID ext: 0x27A9 (10153)                             |
|  PID: 0x0012 (18)                                                      EIT  |
|  0x4E (78, EIT p/f Actual), TID ext: 0xFE00 (65024)                         |
|  PID: 0x0014 (20)                                                  TDT/TOT  |
|  0x73 (115, TOT)                                                            |
âœ“ EIT table detected - event information should be available
âœ“ TOT table detected - time information should be available
Moving final output to destination
Final output ready: output/scene_06min/jtv_scene_06min.ts(with EIT metadata) (106M)
Generating report
Report generated: output/scene_06min/generation_report.txt
CSV structure: output/scene_06min/segment_structure.csv
Technical verification:
Duration: 360.729867s, Size: 110249028 bytes, Bitrate: 2445021 bps
Verifying broadcast compatibility
PSI/SI structure verification:
pid:pid=17:access=clear:servcount=0:global:bitrate=3177:bitrate204=3447:packets=721:clear=721:scrambled=0:invalidscrambling=0:af=0:pcr=0:pts=0:dts=0:pcrleap=0:ptsleap=0:dtsleap=0:discontinuities=0:duplicated=0:unitstart=721:description=SDT/BAT
pid:pid=20:access=clear:servcount=0:global:bitrate=1036:bitrate204=1124:packets=235:clear=235:scrambled=0:invalidscrambling=0:af=0:pcr=0:pts=0:dts=0:pcrleap=0:ptsleap=0:dtsleap=0:discontinuities=0:duplicated=0:unitstart=235:description=TDT/TOT
Broadcast compatibility checks:
1. Service information:
    Service Id: 0xFE00 (65024), EITs: no, EITp/f: yes, CA mode: free
    - Descriptor 0: Service (0x48, 72), 18 bytes
      Service type: 0x01 (Digital television service)
2. Time information:
* TOT, TID 0x73 (115), PID 0x0014 (20)
1. Event information:
    - Event Id: 0x03E9 (1001)
      - Descriptor 0: Short Event (0x4D, 77), 48 bytes
        Event name: "JTV Gen Program"
Broadcast verification procedure:
  1. Check PSI/SI metadata injection
  2. Verify service information display
  3. Confirm the following are included:
     âœ… Genre information
     âœ… Resolution information
     âœ… Service name: JTV Gen
     âœ… Start time: 2024-12-31 15:00:00
Cleaning up temporary files
=== JTV Gen Completed ===

```

</details>

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³

- `--debug` - è©³ç´°ãªãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ã‚’æœ‰åŠ¹åŒ–
- `-c, --config FILE` - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: scene_06min.confï¼‰
- `-y, --yes` - ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦å³åº§ã«ç”Ÿæˆé–‹å§‹
- `-h, --help` - è©³ç´°ãªãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ CSV å½¢å¼ã§ç•ªçµ„æ§‹æˆã‚’å®šç¾©ã—ã¾ã™ï¼š

```text
# TV Program Configuration
# Format: SECTION_TYPE,SECTION_NAME,START_FRAME,END_FRAME
# SECTION_TYPE: RecMargin, Main, CM
# START_FRAME,END_FRAME: Frame range (29.97fps)

# Program Structure
SECTION_TYPE,SECTION_NAME,START_FRAME,END_FRAME
Main,Main_1,0,1000
CM,CM1-1,1001,1798

```

## å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼š

- `output/<CONFIG_BASE>/jtv_[config].ts` - æœ€çµ‚çš„ãª MPEG-TS å‡ºåŠ›
- `output/<CONFIG_BASE>/generation_report.txt` - è©³ç´°ãªç”Ÿæˆãƒ¬ãƒãƒ¼ãƒˆ
- `output/<CONFIG_BASE>/segment_structure.csv` - ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿
- `tv_generation.log` - ç”Ÿæˆãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«

## ä¸­æ–­å‡¦ç†

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä¸­æ–­ï¼ˆCtrl+Cã€SIGTERMï¼‰ã‚’é©åˆ‡ã«å‡¦ç†ã—ã¾ã™ï¼š

- å®Ÿè¡Œä¸­ã® ffmpeg ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµ‚äº†
- ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- æ˜ç¢ºãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

## ãƒ‡ãƒãƒƒã‚°

ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ï¼ˆ`--debug`ï¼‰ã§ã¯ï¼š

- è©³ç´°ãªå‡¦ç†ãƒ­ã‚°ã‚’å‡ºåŠ›
- ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿æŒ
- å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®å‡¦ç†çŠ¶æ³ã‚’è¡¨ç¤º

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### TSDuck ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ

```bash
# Ubuntu ã®å ´åˆ
wget "https://github.com/tsduck/tsduck/releases/latest/download/tsduck_*.deb"
sudo apt install "./tsduck_*.deb"

```

### FFmpeg ã®ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼

- å®Œå…¨ãª FFmpeg ãƒ“ãƒ«ãƒ‰ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
- ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã¾ãŸã¯å…¬å¼ãƒ“ãƒ«ãƒ‰ã‚’ä½¿ç”¨

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

[AGPL-3.0 license](LICENSE)
